flowchart TD
    Start["ðŸ“„ Start: Transcript File
    ðŸ“œ run_multilevel_extraction.py"] --> Parse["ðŸ” Parse Transcript
    ðŸ“œ transcript_parser.py::parse_file()"]
    
    Parse --> Split["âœ‚ï¸ Split into Utterances
    ðŸ“œ transcript_parser.py::Utterance"]
    
    Split --> Loop{"ðŸ”„ For Each Utterance
    ðŸ“œ extractor.py::extract_from_file()"}
    
    Loop --> Filter["ðŸš¦ Stage 1: Belief Filter
    ðŸ“œ classifier.py::stage1_filter()"]
    
    Filter --> Q1["Q1: Does this text contain at least one
    identifiable belief or value judgment?"]
    Filter --> Q2["Q2: Does this statement reveal what
    the speaker believes, even implicitly?"]
    Filter --> Q3["Q3: Is this belief likely endorsed or
    sympathetically discussed by the speaker?"]
    Filter --> Q4["Q4: Does this belief reveal anything about
    the speaker's worldview or preferences?"]
    
    Q1 --> IsBeliefCheck{"â“ Is Belief?
    Pass: Q2+Q3+Q4=YES OR confidenceâ‰¥0.6"}
    Q2 --> IsBeliefCheck
    Q3 --> IsBeliefCheck
    Q4 --> IsBeliefCheck
    
    IsBeliefCheck -->|"âŒ No"| Skip["â­ï¸ Skip"]
    
    IsBeliefCheck -->|"âœ… Yes"| AtomicHeader["âš¡ Extract Atomic Beliefs
    ðŸ“œ classifier.py::extract_atomic_beliefs()"]
    
    AtomicHeader --> Rule1["Rule 1: Extract ALL distinct beliefs/claims"]
    AtomicHeader --> Rule2["Rule 2: Each must be clear, standalone, atomic"]
    AtomicHeader --> Rule3["Rule 3: Remove quotes, questions, narration, fluff"]
    AtomicHeader --> Rule4["Rule 4: Do NOT add new meaning"]
    AtomicHeader --> Rule5["Rule 5: Preserve speaker's intent"]
    AtomicHeader --> Rule6["Rule 6: Return empty array if no beliefs"]
    
    Rule1 --> Certainty["ðŸŽ¯ Classify Certainty
    binary: Absolute with no hedging
    hedged: Contains uncertainty markers"]
    Rule2 --> Certainty
    Rule3 --> Certainty
    Rule4 --> Certainty
    Rule5 --> Certainty
    Rule6 --> Certainty
    
    Certainty --> Stage2Header["ðŸ§  Stage 2: Full Classification
    ðŸ“œ classifier.py::stage2_classify()"]
    
    Stage2Header --> ConvictionCat["ðŸ’ª Conviction Indicators Q5-Q7"]
    Stage2Header --> BeliefTypeCat["ðŸŽ¯ Belief Type Q8-Q13"]
    Stage2Header --> ClaimTypeCat["ðŸ“‹ Claim Type Q14-Q15"]
    Stage2Header --> TierCat["ðŸ† Tier Classification Q16-Q26"]
    Stage2Header --> ScoringCat["ðŸ“Š Scoring Q27-Q28"]
    Stage2Header --> CategorizationCat["ðŸ·ï¸ Categorization Q29-Q31"]
    
    ConvictionCat --> Q5["Q5: Does wording indicate strong/absolute
    commitment always/never/must/cannot?"]
    ConvictionCat --> Q6["Q6: Does context suggest speaker repeats
    or consistently relies on this belief?"]
    ConvictionCat --> Q7["Q7: Does speaker defend or justify this belief
    against alternatives or objections?"]
    
    BeliefTypeCat --> Q8["Q8: Is this belief about fundamental nature of
    reality, human nature, purpose, or existence?"]
    BeliefTypeCat --> Q9["Q9: Is this belief about how truth/knowledge
    should be formed, who/what to trust?"]
    BeliefTypeCat --> Q10["Q10: Is this belief about broad moral principles
    of right/wrong or good/bad across situations?"]
    BeliefTypeCat --> Q11["Q11: Is this belief a cross-domain principle
    speaker applies in multiple areas of life?"]
    BeliefTypeCat --> Q12["Q12: Is this belief primarily about large-scale
    systems state/markets/money/religion/tech/law?"]
    BeliefTypeCat --> Q13["Q13: Is this belief mainly about one specific
    domain Bitcoin/real estate/AI/health/education?"]
    
    ClaimTypeCat --> Q14["Q14: Is this statement concrete, testable,
    or time-bound claim prediction/empirical assertion?"]
    ClaimTypeCat --> Q15["Q15: Is this statement casual preference,
    offhand comment, joke, or musing?"]
    
    TierCat --> Q16["Q16: Should this be labeled as Core Axiom
    foundational, cross-domain, defended, stable?"]
    TierCat --> Q17["Q17: Should this be labeled as Worldview Pillar
    big-picture moral/political/economic frame?"]
    TierCat --> Q18["Q18: Should this be labeled as Identity-Defining Value
    this is who I am / we are?"]
    TierCat --> Q19["Q19: Should this be labeled as Meta-Principle
    rule for how to choose/update beliefs?"]
    TierCat --> Q20["Q20: Should this be labeled as Cross-Domain Rule
    or Heuristic action rule in many contexts?"]
    TierCat --> Q21["Q21: Should this be labeled as Stable Domain Belief
    consistent stance within one topic?"]
    TierCat --> Q22["Q22: Should this be labeled as Repeated Strategy
    or Playbook tactic speaker endorses/uses?"]
    TierCat --> Q23["Q23: Should this be labeled as Concrete Claim
    or Prediction?"]
    TierCat --> Q24["Q24: Should this be labeled as Situational Opinion
    tied to a narrow context?"]
    TierCat --> Q25["Q25: Should this be labeled as Loose Take
    Joke or Aesthetic Vibe?"]
    TierCat --> Q26["Q26: What is the SINGLE BEST-FITTING tier?
    Choose ONE from Q16-25"]
    
    ScoringCat --> Q27["Q27: On a 0-1 scale, how strong is
    the speaker's conviction in this belief?"]
    ScoringCat --> Q28["Q28: On a 0-1 scale, how stable/long-term
    does this belief appear given the context?"]
    
    CategorizationCat --> Q29["Q29: What is the single best-fitting category label?
    epistemic/moral/political/economic/spiritual/social/tech/health/bitcoin/other"]
    CategorizationCat --> Q30["Q30: In one short phrase, what higher-level belief
    or axiom does this belief rely on? parent_hint"]
    CategorizationCat --> Q31["Q31: Does this belief explicitly reject or oppose
    another belief/group/position in-group vs out-group?"]
    
    Q5 --> Compile["ðŸ“¦ Compile Belief Record
    ðŸ“œ classifier.py::BeliefClassification"]
    Q6 --> Compile
    Q7 --> Compile
    Q8 --> Compile
    Q9 --> Compile
    Q10 --> Compile
    Q11 --> Compile
    Q12 --> Compile
    Q13 --> Compile
    Q14 --> Compile
    Q15 --> Compile
    Q16 --> Compile
    Q17 --> Compile
    Q18 --> Compile
    Q19 --> Compile
    Q20 --> Compile
    Q21 --> Compile
    Q22 --> Compile
    Q23 --> Compile
    Q24 --> Compile
    Q25 --> Compile
    Q26 --> Compile
    Q27 --> Compile
    Q28 --> Compile
    Q29 --> Compile
    Q30 --> Compile
    Q31 --> Compile
    
    Compile --> MoreUtterances{"ðŸ” More Utterances?"}
    MoreUtterances -->|Yes| Loop
    MoreUtterances -->|No| DataFrame["ðŸ—‚ï¸ Create DataFrame
    ðŸ“œ extractor.py::_to_dataframe()"]
    
    DataFrame --> SaveOutput["ðŸ’¾ Save Output CSV/Parquet
    ðŸ“œ multilevel_extractor.py::save_output()"]
    
    SaveOutput --> Stats["ðŸ“ˆ Calculate Summary Stats
    ðŸ“œ multilevel_extractor.py::get_cost_stats()"]
    
    Stats --> Display["âœ¨ Display Results
    ðŸ“œ run_multilevel_extraction.py"]
    
    Skip --> MoreUtterances
    
    classDef newFeature fill:#90EE90,stroke:#2d5016,stroke-width:2px,color:#000
    classDef aiStep fill:#87CEEB,stroke:#104e8b,stroke-width:2px,color:#000
    classDef dataStep fill:#FFE4B5,stroke:#8b6914,stroke-width:2px,color:#000
    classDef questionBox fill:#FFE4E1,stroke:#8b4513,stroke-width:1px,color:#000
    classDef categoryHeader fill:#E6E6FA,stroke:#4B0082,stroke-width:2px,color:#000
    
    class AtomicHeader,Certainty newFeature
    class Filter,Stage2Header aiStep
    class DataFrame,SaveOutput,Stats dataStep
    class Q1,Q2,Q3,Q4,Q5,Q6,Q7,Q8,Q9,Q10,Q11,Q12,Q13,Q14,Q15,Q16,Q17,Q18,Q19,Q20,Q21,Q22,Q23,Q24,Q25,Q26,Q27,Q28,Q29,Q30,Q31,Rule1,Rule2,Rule3,Rule4,Rule5,Rule6 questionBox
    class ConvictionCat,BeliefTypeCat,ClaimTypeCat,TierCat,ScoringCat,CategorizationCat categoryHeader
